name: CI

# åœ¨mainåˆ†æ”¯å‘ç”Ÿpushäº‹ä»¶æ—¶è§¦å‘ã€‚
on:
  push:
    branches:
      - main

env: # è®¾ç½®ç¯å¢ƒå˜é‡
  TZ: Asia/Shanghai # æ—¶åŒºï¼ˆè®¾ç½®æ—¶åŒºå¯ä½¿é¡µé¢ä¸­çš„`æœ€è¿‘æ›´æ–°æ—¶é—´`ä½¿ç”¨æ—¶åŒºæ—¶é—´ï¼‰

#  # éƒ¨ç½²åˆ°æœåŠ¡å™¨ç›¸å…³é…ç½®
#  SERVER_IP: 8.142.217.82 # è¿œç¨‹æœåŠ¡å™¨IP
#  SERVER_SSH_USERNAME: root # è¿œç¨‹æœåŠ¡å™¨ssh ç”¨æˆ·å
#  SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }} # è®¤è¯æœåŠ¡å™¨ç§˜é’¥å¯¹çš„ç§é’¥
#  SERVER_SITE_PATH: /home/www/solmp.github.io/ # æœåŠ¡å™¨ä¿å­˜è·¯å¾„ï¼Œéœ€è¦ç¡®è®¤æ­¤ç›®å½•å·²åœ¨æœåŠ¡ç«¯åˆ›å»º

jobs:
  build: # è‡ªå®šä¹‰åç§°
    runs-on: ubuntu-latest # è¿è¡Œåœ¨è™šæ‹Ÿæœºç¯å¢ƒubuntu-latest

    strategy:
      matrix:
        node-version: [ 14.x ]

    steps:
      - name: Checkout # æ­¥éª¤1
        uses: actions/checkout@v1 # ä½¿ç”¨çš„åŠ¨ä½œã€‚æ ¼å¼ï¼šuserName/repoNameã€‚ä½œç”¨ï¼šæ£€å‡ºä»“åº“ï¼Œè·å–æºç ã€‚ å®˜æ–¹actionsåº“ï¼šhttps://github.com/actions
      - name: Use Node.js ${{ matrix.node-version }} # æ­¥éª¤2
        uses: actions/setup-node@v1 # ä½œç”¨ï¼šå®‰è£…nodejs
        with:
          node-version: ${{ matrix.node-version }} # ç‰ˆæœ¬

      # step3-A-1: éƒ¨ç½²åˆ°è¿œç«¯ä»“åº“ - âœ”æµ‹è¯•é€šè¿‡
      - name: run deploy
        env: # è®¾ç½®ç¯å¢ƒå˜é‡
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # tokenç§å¯†å˜é‡
        run: npm install && npm run deploy

#      # step3-A-2: éƒ¨ç½²åˆ°æœåŠ¡å™¨ - âœ”æµ‹è¯•é€šè¿‡
#      # åˆ©ç”¨actionæŠŠbuildå¥½çš„æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ /home/www/solmp.github.io è·¯å¾„ä¸‹,éœ€è¦ç¡®è®¤æ­¤ç›®å½•å·²åœ¨æœåŠ¡ç«¯åˆ›å»º
#      - name: deploy to server
#        uses: wlixcc/SFTP-Deploy-Action@v1.0
#        with:
#          username: ${{ env.SERVER_SSH_USERNAME }}   #ssh user name
#          port: '22' # è¿œç¨‹æœåŠ¡å™¨sshç«¯å£ï¼Œé»˜è®¤22
#          server: ${{ env.SERVER_IP }} # è¿œç¨‹æœåŠ¡å™¨IP
#          ssh_private_key: ${{ env.SSH_PRIVATE_KEY }} # è®¤è¯æœåŠ¡å™¨ç§˜é’¥å¯¹çš„ç§é’¥
#          local_path: 'docs/.vuepress/dist/*'  # å¯¹åº”æˆ‘ä»¬é¡¹ç›®æ‰“åŒ…åçš„é™æ€æ–‡ä»¶è·¯å¾„
#          remote_path: ${{ env.SERVER_SITE_PATH }} # æœåŠ¡å™¨ä¸Šçš„è·¯å¾„


#      # step3-Bï¼šä»…éƒ¨ç½²åˆ°github pageï¼ˆä¸æ¨é€åˆ°å…¶å®ƒå¹³å°ï¼‰- âœ”æµ‹è¯•é€šè¿‡
#      # 1. build
#      - name: Install and Build ğŸ”§ # https://github.com/JamesIves/github-pages-deploy-action
#        run: |
#          npm install
#          npm run build
#          cd docs/.vuepress/dist
#          echo "solmp.vercel.app" > CNAME
#          cd -
#      # 2. deploy
#      - name: Build and Deploy
#        uses: JamesIves/github-pages-deploy-action@4.1.4
#        with:
#          branch: gh-pages # éƒ¨ç½²åˆ°çš„åˆ†æ”¯
#          folder: "docs/.vuepress/dist" # è¦éƒ¨ç½²çš„æ–‡ä»¶å¤¹

